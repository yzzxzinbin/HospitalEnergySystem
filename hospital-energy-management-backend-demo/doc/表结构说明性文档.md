# 数据库表结构DDL

## 1. 角色表 (roles)
存储系统角色信息，用于权限管理

```sql
CREATE TABLE roles (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL UNIQUE COMMENT '角色名称'
);
```

## 2. 用户表 (users)
存储系统用户基本信息

```sql
CREATE TABLE users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(255) NOT NULL UNIQUE COMMENT '用户名',
    password VARCHAR(255) NOT NULL COMMENT '密码',
    email VARCHAR(255) NOT NULL COMMENT '电子邮箱'
);
```

## 3. 用户角色关联表 (user_roles)
建立用户与角色之间的多对多关系

```sql
CREATE TABLE user_roles (
    user_id BIGINT NOT NULL COMMENT '用户ID',
    role_id BIGINT NOT NULL COMMENT '角色ID',
    PRIMARY KEY (user_id, role_id),
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (role_id) REFERENCES roles(id)
);
```

## 4. 医院房间信息表 (rooms)
存储医院各房间的基本信息

```sql
CREATE TABLE rooms (
    id bigint(20) NOT NULL AUTO_INCREMENT,
    room_number varchar(50) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '房间号，例如 "101", "ICU-02"',
    name varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '房间名称，例如 "普通病房", "手术室A", "放射科"',
    floor varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '楼层，例如 "1", "G", "B1"',
    department varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '所属部门，例如 "心内科", "儿科", "行政部"',
    description text COLLATE utf8mb4_unicode_ci COMMENT '房间描述信息',
    PRIMARY KEY (id),
    UNIQUE KEY room_number (room_number)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='医院房间信息表';
```

## 5. 设备模板表 (device_templates)
定义标准设备类型及其规格参数

```sql
CREATE TABLE device_templates (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    template_name VARCHAR(255) NOT NULL COMMENT '设备模板的描述性名称，例如 "美的智能空调X系列", "西门子 Somatom CT扫描仪"',
    manufacturer VARCHAR(100) COMMENT '制造商，例如 "美的", "西门子"',
    model_identifier VARCHAR(100) NOT NULL COMMENT '设备型号的唯一标识符，例如 "KFR-35GW/X", "SOMATOM-X"',
    device_category VARCHAR(100) COMMENT '设备类别，例如 "空调", "CT扫描仪", "照明", "通风设备"',
    description TEXT COMMENT '设备模板的详细描述',
    specifications_json TEXT COMMENT '详细规格参数 (JSON格式，例如 {"color": "white", "dimensions": "WxHxD"})',
    nominal_power_watts DOUBLE COMMENT '标称功率 (瓦特)',
    nominal_water_consumption_lph DOUBLE COMMENT '标称耗水率 (升/小时)',
    nominal_gas_consumption_m3ph DOUBLE COMMENT '标称耗气率 (立方米/小时)',
    estimated_lifespan_years INT COMMENT '预计使用年限',
    image_url VARCHAR(255) COMMENT '设备图片链接',
    UNIQUE KEY uk_manufacturer_model (manufacturer, model_identifier)
) COMMENT='设备模板表 (定义标准设备类型及其规格)';
```

## 6. 房间内设备信息表 (devices)
存储医院各房间内的具体设备信息

```sql
CREATE TABLE devices (
    id bigint(20) NOT NULL AUTO_INCREMENT,
    name varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '设备名称，例如 "呼吸机", "MRI扫描仪", "空调", "LED照明面板"',
    installation_date date DEFAULT NULL COMMENT '安装日期',
    status varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT 'Operational' COMMENT '设备状态，例如 "Operational", "Maintenance", "Offline"',
    room_id bigint(20) DEFAULT NULL COMMENT '所属房间ID, 外键关联到rooms表, 房间删除时此设备room_id置为NULL',
    device_template_id bigint(20) DEFAULT NULL COMMENT '关联的设备模板ID，外键关联到device_templates表',
    PRIMARY KEY (id),
    KEY idx_device_room (room_id),
    KEY idx_device_status (status),
    KEY fk_devices_to_template (device_template_id),
    CONSTRAINT devices_ibfk_1 FOREIGN KEY (room_id) REFERENCES rooms (id) ON DELETE SET NULL,
    CONSTRAINT fk_devices_to_template FOREIGN KEY (device_template_id) REFERENCES device_templates (id) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='房间内设备信息表';
```

## 7. 能源数据表 (energy_data)
存储设备产生的能源消耗数据

```sql
CREATE TABLE energy_data (
    id bigint(20) NOT NULL AUTO_INCREMENT,
    type varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '能源类型',
    value double NOT NULL COMMENT '能源数值',
    timestamp datetime NOT NULL COMMENT '数据时间戳',
    meter_id varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '暂时不启用,默认每个设备自己都能作为计量表',
    device_id bigint(20) DEFAULT NULL COMMENT '关联的设备ID',
    consumption double DEFAULT NULL COMMENT '消耗量',
    unit varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '计量单位',
    PRIMARY KEY (id),
    KEY fk_energydata_device (device_id),
    CONSTRAINT fk_energydata_device FOREIGN KEY (device_id) REFERENCES devices (id) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```